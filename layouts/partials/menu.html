{{- /*
Renders a menu for the given menu ID.

@context {page} page The current page.
@context {string} menuID The menu ID.

@example: {{ partial "menu.html" (dict "menuID" "main" "page" .) }}
*/}}

{{- $page := .page }}
{{- $menuID := .menuID }}

{{- with index site.Menus $menuID }}
  <ul class="nav-menu">
    {{- range . }}
      {{- $url := .URL -}}
      {{- if not (hasPrefix $url "http") -}}
        {{- if not (hasPrefix $url "/") -}}
          {{- $url = printf "/%s/" $url -}}
        {{- else if not (hasSuffix $url "/") -}}
          {{- $url = printf "%s/" $url -}}
        {{- end -}}
      {{- end -}}
      {{- $attrs := dict "href" $url }}
      {{- $isActive := false }}
      {{- if $page.IsMenuCurrent .Menu . }}
        {{- $isActive = true }}
        {{- $attrs = merge $attrs (dict "class" "active" "aria-current" "page") }}
      {{- else if $page.HasMenuCurrent .Menu .}}
        {{- $isActive = true }}
        {{- $attrs = merge $attrs (dict "class" "ancestor" "aria-current" "true") }}
      {{- end }}
      {{- $name := .Name }}
      {{- with .Identifier }}
        {{- with T . }}
          {{- $name = . }}
        {{- end }}
      {{- end }}
      <li class="nav-item{{ if $isActive }} is-active{{ end }}">
        <a class="nav-link"
          {{- range $k, $v := $attrs }}
            {{- with $v }}
              {{- printf " %s=%q" $k $v | safeHTMLAttr }}
            {{- end }}
          {{- end -}}
        >
          {{- with .Params.icon }}
          <span class="nav-icon">{{ . | safeHTML }}</span>
          {{- end }}
          <span class="nav-text">{{ $name }}</span>
        </a>
        {{- with .Children }}
          <ul class="nav-submenu">
            {{- range . }}
              <li class="nav-subitem">
                <a href="{{ .URL }}" class="nav-sublink">{{ .Name }}</a>
              </li>
            {{- end }}
          </ul>
        {{- end }}
      </li>
    {{- end }}
  </ul>
{{- end }}
