{{- $page := .page -}}
{{- $index := .index | default 0 -}}
{{- $isEven := eq (mod $index 2) 0 -}}

{{- /* Get cover image from cover.image or banner */ -}}
{{- $coverImage := "" -}}
{{- with $page.Params.cover -}}
  {{- with .image -}}
    {{- $coverImage = . -}}
  {{- end -}}
{{- end -}}
{{- if not $coverImage -}}
  {{- with $page.Params.banner -}}
    {{- $coverImage = . -}}
  {{- end -}}
{{- end -}}

{{- $optimizedImage := $coverImage -}}
{{- if and $coverImage (site.Params.imageOptimization.enabled) (site.Params.imageOptimization.wsrv.enabled) -}}
  {{- $width := site.Params.imageOptimization.wsrv.postCard.width | default 600 -}}
  {{- $height := site.Params.imageOptimization.wsrv.postCard.height | default 300 -}}
  {{- $quality := site.Params.imageOptimization.wsrv.postCard.quality | default 85 -}}
  {{- $optimizedImage = printf "https://wsrv.nl/?url=%s&w=%d&h=%d&q=%d&fit=cover&output=webp" $coverImage $width $height $quality -}}
{{- end -}}

<article class="post-card{{ if $isEven }} post-card--even{{ else }} post-card--odd{{ end }}">
  {{- if $optimizedImage }}
  <div class="post-card__thumb">
    <a href="{{ $page.RelPermalink }}" class="post-card__thumb-link">
      <img src="{{ $optimizedImage }}" alt="{{ $page.Title }}" class="post-card__image" loading="lazy">
    </a>
  </div>
  {{- end }}

  <div class="post-card__content">
    <div class="post-card__meta">
      <time class="post-card__date" datetime="{{ $page.Date.Format `2006-01-02T15:04:05-07:00` }}">
        <svg class="meta-icon" viewBox="0 0 24 24" width="14" height="14">
          <path fill="currentColor" d="M11.99 2C6.47 2 2 6.48 2 12s4.47 10 9.99 10C17.52 22 22 17.52 22 12S17.52 2 11.99 2zM12 20c-4.42 0-8-3.58-8-8s3.58-8 8-8 8 3.58 8 8-3.58 8-8 8zm.5-13H11v6l5.25 3.15.75-1.23-4.5-2.67z"/>
        </svg>
        Posted on {{ $page.Date.Format "01-02-2006" }}
      </time>
    </div>

    <h2 class="post-card__title">
      <a href="{{ $page.RelPermalink }}">{{ $page.Title }}</a>
    </h2>

    <div class="post-card__stats">
      {{- with $page.Params.categories }}
      {{- $cat := index . 0 }}
      <a href="{{ `/categories/` | relURL }}{{ $cat | urlize }}/" class="post-card__category">
        <svg class="meta-icon" viewBox="0 0 24 24" width="14" height="14">
          <path fill="currentColor" d="M20 6h-8l-2-2H4c-1.1 0-1.99.9-1.99 2L2 18c0 1.1.9 2 2 2h16c1.1 0 2-.9 2-2V8c0-1.1-.9-2-2-2zm0 12H4V8h16v10z"/>
        </svg>
        {{ $cat }}
      </a>
      {{- end }}

      {{- with $page.Params.tags }}
      {{- $tag := index . 0 }}
      <a href="{{ `/tags/` | relURL }}{{ $tag | urlize }}/" class="post-card__tag">
        <svg class="meta-icon" viewBox="0 0 24 24" width="14" height="14">
          <path fill="currentColor" d="M21.41 11.58l-9-9C12.05 2.22 11.55 2 11 2H4c-1.1 0-2 .9-2 2v7c0 .55.22 1.05.59 1.42l9 9c.36.36.86.58 1.41.58.55 0 1.05-.22 1.41-.59l7-7c.37-.36.59-.86.59-1.41 0-.55-.23-1.06-.59-1.42zM5.5 7C4.67 7 4 6.33 4 5.5S4.67 4 5.5 4 7 4.67 7 5.5 6.33 7 5.5 7z"/>
        </svg>
        {{ $tag }}
      </a>
      {{- end }}
    </div>

    <p class="post-card__summary">
      {{ $page.Summary | plainify | truncate 150 }}
    </p>

    <div class="post-card__more">
      <span class="post-card__dots">• • •</span>
    </div>
  </div>
</article>

